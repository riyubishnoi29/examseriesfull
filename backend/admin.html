<!DOCTYPE html>
<html>
<head>
  <title>Add Question</title>
</head>
<body>
  <h2>Add New Question</h2>
  <form id="questionForm">
    Mock ID: <input type="number" name="mock_id" required><br><br>

    Question: <textarea name="question_text" required></textarea><br><br>

    Option 1: <input type="text" name="option1" required><br>
    Option 2: <input type="text" name="option2" required><br>
    Option 3: <input type="text" name="option3" required><br>
    Option 4: <input type="text" name="option4" required><br><br>

    Correct Answer: <input type="text" name="correct_answer" required><br><br>

    Marks: <input type="number" name="marks" value="1"><br><br>

    <button type="submit">Add Question</button>
  </form>

  <script>
    // 🔒 Check admin login on page load
    const token = localStorage.getItem("adminToken"); // Token stored after login
    if (!token) {
      alert("❌ You are not authorized. Please login first.");
      window.location.href = "login_admin.html"; // redirect to admin login page
    }

    // Handle question form submission
    document.getElementById("questionForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const data = {
        mock_id: parseInt(formData.get("mock_id")),
        question_text: formData.get("question_text"),
        options: [
          formData.get("option1"),
          formData.get("option2"),
          formData.get("option3"),
          formData.get("option4")
        ],
        correct_answer: formData.get("correct_answer"),
        marks: parseInt(formData.get("marks"))
      };

      try {
        // ✅ Send the token in Authorization header
        const res = await fetch("https://rankyard.in/questions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}` // <-- THIS IS THE CHANGE
          },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        alert(result.message || result.error);

      } catch (err) {
        console.error(err);
        alert("❌ Something went wrong. Try again.");
      }
    });
  </script>
</body>
</html>
